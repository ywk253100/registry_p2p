---
- hosts: tracker
  tasks:
  - name: clean tracker
    shell: kill $(ps -ef | awk '/opentracker/{print $2}')
    ignore_errors: True

- hosts: manager
  tasks:
  - name: clean manager
    shell: kill $(ps -ef | awk '/manager -t/{print $2}');rm /tmp/log/*
    ignore_errors: True

- hosts: agent
  tasks:
  - name: clean agent
    shell: /root/registry_p2p/agent/clean.sh
    ignore_errors: True

- hosts: tracker
  tasks:
  - name: start tracker
    shell: nohup /root/registry_p2p/tracker/opentracker > /tmp/log/tracker.log 2>&1 &

- hosts: manager
  vars:
    ratio: 120
  tasks:
  - name: start manager
    shell: export ratio="{{ ratio }}";nohup /root/registry_p2p/manager/manager -t http://10.110.187.211:6969/announce > /tmp/log/manager.log 2>&1 &

- hosts: agent
  vars:
    num: 12
  tasks:
  - name: start agent
    shell: /root/registry_p2p/agent/start_containers.sh "{{ num }}"